---
title: "T2. Instalación de un servidor Web"
date: 2020-01-15T10:49:14+01:00
draft: false
---

#### Croqueta:

Entramos en 

```
debian@croqueta:~$ sudo nano /etc/dhcp/dhclient.conf
``` 

Y quitamos los siguiente parametros:

```
domain-name, domain-name-servers, domain-search
```

Editamos el archivo:

```
debian@croqueta:~$ sudo nano /etc/resolv.conf
``` 

```
domain croqueta.ernesto.gonzalonazareno.org
search croqueta.ernesto.gonzalonazareno.org
nameserver 192.168.202.2
```

```
127.0.1.1 croqueta.ernesto.gonzalonazareno.org croqueta.ernesto
10.0.0.9 tortilla.ernesto.gonzalonazareno.org tortilla.ernesto
10.0.0.11 salmorejo.ernesto.gonzalonazareno.org salmorejo.ernesto
#127.0.0.1 localhost
```

```
debian@croqueta:~$ hostname 
    croqueta
debian@croqueta:~$ hostname -f
    croqueta.ernesto.gonzalonazareno.org
```

#### Tortilla:

Editamos el fichero:

```
ubuntu@tortilla:~$ sudo nano /etc/systemd/resolved.conf 
```

```
[Resolve]
DNS=192.168.202.2
#FallbackDNS=
Domains=tortilla.ernesto.gonzalonazareno.org
#LLMNR=no
#MulticastDNS=no
#DNSSEC=no
#Cache=yes
#DNSStubListener=yes
```

Reiniciamos y comprobamos el fichero **/etc/resolv.conf**

```
nameserver 127.0.0.53
options edns0
search tortilla.ernesto.gonzalonazareno.org openstacklocal
```

```
ubuntu@tortilla:~$ hostname
    tortilla
ubuntu@tortilla:~$ hostname -f
    tortilla.ernesto.gonzalonazareno.org
```

#### Salmorejo:

Entramos en el siguiente fichero de configuración de 

```
[centos@salmorejo ~]$ sudo nano /etc/sysconfig/network-scripts/ifcfg-eth0 
```

```
# Created by cloud-init on instance boot automatically, do not edit.
#
BOOTPROTO=dhcp
DEVICE=eth0
HWADDR=fa:16:3e:29:03:a9
ONBOOT=yes
TYPE=Ethernet
USERCTL=no
PEERDNS=no
```

Editamos la configuración:

```
[centos@salmorejo ~]$ sudo nano /etc/resolv.conf

; generated by /usr/sbin/dhclient-script
search salmorejo.ernesto.gonzalonazareno.org
nameserver 192.168.202.2
``` 

```
[centos@salmorejo ~]$ hostname
    salmorejo
[centos@salmorejo ~]$ hostname -f
    salmorejo.ernesto.gonzalonazareno.org
```

Instalamos un servidor web nginx.

Añadimos los repositorios de nginx:

```
sudo yum install epel-release
```

Instalamos nginx:

```
sudo yum install nginx
```

Activamos el puerto HTTP en openstack y ya podremos entrar en nginx por la IP

![nginxcentos][static/img/nginxcentos.jpg]

Actualizamos:

```
[root@salmorejo html]# yum update -y
```

Instalamos el repositorio **EPEL** :

```
[root@salmorejo html]# yum install epel-release -y
```

Instalamos el paquete **nginx** .

```
[root@salmorejo html]# yum -y install nginx
```

Arrancamos el servidor nginx.

```
[root@salmorejo html]# service nginx start
[root@salmorejo html]# systemctl enable
[root@salmorejo html]# systemctl start nginx
[root@salmorejo html]# systemctl status nginx
```

Vamos a instalar el repositorio de **Remi** .

```
[root@salmorejo html]# yum -y install http://rpms.remirepo.net/enterprise/remi-release-7.rpm
[root@salmorejo html]# yum install -y yum-utils --enablerepo="base"
[root@salmorejo html]# yum-config-manager --enable remi-php73
[root@salmorejo html]# yum update -y
```

Instalamos **PHP 7.3**

```
[root@salmorejo html]# yum install -y php73
[root@salmorejo html]# yum install -y php73-php-fpm php73-php-gd php73-php-json php73-php-mbstring php73-php-mysqlnd php73-php-xml php73-php-xmlrpc php73-php-opcache
[root@salmorejo html]# php73 -v
[root@salmorejo html]# php73 --modules
```

Arrancamos el servicio **nginx**

```
[root@salmorejo html]# systemctl enable php73-php-fpm.service
[root@salmorejo html]# systemctl start php73-php-fpm.service
[root@salmorejo html]# systemctl status php73-php-fpm.service
```

Modificamos la configuración de nuestro **PHP FPM**

```
[root@salmorejo html]# nano /etc/opt/remi/php73/php-fpm.d/www.conf
    user = nginx
    group = nginx
```

Reiniciamos el servicio **PHP FPM** para aplicar los cambios

```
[root@salmorejo html]# systemctl restart php73-php-fpm.service
```

Vamos a editar el fichero de configuración de **nginx** .

Tenemos que agregar lo siguiente:

```
    location ~ \.php$ {
            root /usr/share/nginx/html;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            include        fastcgi_params;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
    }      
``` 

```
[root@salmorejo html]# nano /etc/nginx/nginx.conf
[root@salmorejo html]# service nginx restart
```

Vamos a crear el fichero **PHP**

```
[root@salmorejo html]# nano /usr/share/nginx/html/info.php
[root@salmorejo html]# service nginx restart
```

Accederemos mediante nuestro navegador Web

![infophp][static/img/infophp.jpg]


**Servidor de base de datos**

Instalamos **MariaDB**:

```
ubuntu@tortilla:~$ sudo apt-get install mariadb-server
```

Para crear la base de datos deberemos conectarnos como usuario root ejecutando la sentencia **mysql -u root**
(haciendo uso de los privilegios de superusuario). Una vez en la consola de **mysql** ejecutamos

```
CREATE DATABASE cloudernesto;
```

Y nos conectamos con **USE DATABASE “nombre de la db”**.

Después de haber creado la base de datos, crearemos un usuario con privilegios sobre dicha base de datos. Ejecutamos:

```
MariaDB [(none)]> GRANT ALL PRIVILEGES ON *.* TO 'croqueta'@'10.0.0.3' IDENTIFIED BY 'croqueta' WITH GRANT OPTION;
Query OK, 0 rows affected (0.00 sec)
```

```
MariaDB [(none)]> GRANT ALL PRIVILEGES ON *.* TO 'salmorejo'@'10.0.0.11' IDENTIFIED BY 'salmorejo' WITH GRANT OPTION;
Query OK, 0 rows affected (0.00 sec)
```

Una vez creado el usuario, accedemos con **mysql -u “usuario” -p** y empezamos a crear las tablas e insertar los datos.

Para configurar el acceso remoto de mariadb deberemos editar el archivo **/etc/mysql/mariadb.conf.d/50-server.cnf**, comentar la línea skip-external-locking y modificar la línea bind-address = 127.0.0.1 a bind-address = 0.0.0.0

Después de esto reiniciamos el servicio con el comando **systemctl restart mysql.**

En CentOS tenemos que agregar los repositorios de mariadb:

```
[centos@salmorejo ~]$ sudo nano /etc/yum.repos.d/MariaDB.repo
```

```
[mariadb]
name = MariaDB-10.3.14
baseurl=http://yum.mariadb.org/10.3.14/centos7-amd64
# alternative: baseurl=http://archive.mariadb.org/mariadb-10.3.14/yum/centos7-amd64
gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
gpgcheck=1
```

```
[centos@salmorejo ~]$ sudo yum install MariaDB-client
```

![mysqlremoto](img/mysqlremoto.jpg)

